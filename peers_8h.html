<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>libdht: /home/travis/build/naturalpolice/libdht/include/dht/peers.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libdht
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_e7d75a8427fafea27b500c59b0da00f9.html">dht</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">peers.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Announce or search peers for an infohash.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for peers.h:</div>
<div class="dyncontent">
<div class="center"><img src="peers_8h__incl.png" border="0" usemap="#_2home_2travis_2build_2naturalpolice_2libdht_2include_2dht_2peers_8h" alt=""/></div>
<map name="_2home_2travis_2build_2naturalpolice_2libdht_2include_2dht_2peers_8h" id="_2home_2travis_2build_2naturalpolice_2libdht_2include_2dht_2peers_8h">
</map>
</div>
</div>
<p><a href="peers_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a54b3df17f6aa492ab46dc1ee8e19856b"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peers_8h.html#a54b3df17f6aa492ab46dc1ee8e19856b">get_peers_callback</a>) (const unsigned char info_hash[20], const struct sockaddr_storage *peers, size_t count, void *opaque)</td></tr>
<tr class="memdesc:a54b3df17f6aa492ab46dc1ee8e19856b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peer search complete callback.  <a href="#a54b3df17f6aa492ab46dc1ee8e19856b">More...</a><br /></td></tr>
<tr class="separator:a54b3df17f6aa492ab46dc1ee8e19856b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2554096dd998f0f2465dcbd9e59c202a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peers_8h.html#a2554096dd998f0f2465dcbd9e59c202a">dht_get_peers</a> (struct <a class="el" href="structdht__node.html">dht_node</a> *node, const unsigned char info_hash[20], <a class="el" href="peers_8h.html#a54b3df17f6aa492ab46dc1ee8e19856b">get_peers_callback</a> callback, void *opaque, <a class="el" href="node_8h.html#a75404d24c510013ce7d61dee6d25323b">dht_search_t</a> *handle)</td></tr>
<tr class="memdesc:a2554096dd998f0f2465dcbd9e59c202a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Search the DHT for peers for an infohash.  <a href="#a2554096dd998f0f2465dcbd9e59c202a">More...</a><br /></td></tr>
<tr class="separator:a2554096dd998f0f2465dcbd9e59c202a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a505a9824ae73cc494549fb2839276f2c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peers_8h.html#a505a9824ae73cc494549fb2839276f2c">dht_announce_peer</a> (struct <a class="el" href="structdht__node.html">dht_node</a> *node, const unsigned char info_hash[20], int port, <a class="el" href="peers_8h.html#a54b3df17f6aa492ab46dc1ee8e19856b">get_peers_callback</a> callback, void *opaque, <a class="el" href="node_8h.html#a75404d24c510013ce7d61dee6d25323b">dht_search_t</a> *handle)</td></tr>
<tr class="memdesc:a505a9824ae73cc494549fb2839276f2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Announce peer for an infohash.  <a href="#a505a9824ae73cc494549fb2839276f2c">More...</a><br /></td></tr>
<tr class="separator:a505a9824ae73cc494549fb2839276f2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Announce or search peers for an infohash. </p>
<p>This contains defines high-level definitions for searching or announcing peers. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a54b3df17f6aa492ab46dc1ee8e19856b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* get_peers_callback) (const unsigned char info_hash[20], const struct sockaddr_storage *peers, size_t count, void *opaque)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Peer search complete callback. </p>
<p>This callback is called when a search for peers completes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">info_hash</td><td>The target infohash of the search. </td></tr>
    <tr><td class="paramname">peers</td><td>Array of peer addresses, or NULL if no peers have been found or the search was cancelled. </td></tr>
    <tr><td class="paramname">count</td><td>Length of the <em>peers</em> array. </td></tr>
    <tr><td class="paramname">opaque</td><td>User data pointer passed to <a class="el" href="peers_8h.html#a2554096dd998f0f2465dcbd9e59c202a">dht_get_peers</a> or <a class="el" href="peers_8h.html#a505a9824ae73cc494549fb2839276f2c">dht_announce_peer</a>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a505a9824ae73cc494549fb2839276f2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dht_announce_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdht__node.html">dht_node</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char&#160;</td>
          <td class="paramname"><em>info_hash</em>[20], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="peers_8h.html#a54b3df17f6aa492ab46dc1ee8e19856b">get_peers_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>opaque</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="node_8h.html#a75404d24c510013ce7d61dee6d25323b">dht_search_t</a> *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Announce peer for an infohash. </p>
<p>Add the IP address of the current node and the given port number to the list of peers for the given infohash. This is traditionally used to announce that the "peer" controlling the current node is downloading a torrent, but other use are possible. If the <em>port</em> parameter is -1, the node's current UDP port is used. Since it is necessary to perform a search on the DHT before sending announce queries, the completion callback will be called with the list of already existing peers found for the given infohash. The returned handle can be used to cancel the pending announce with <a class="el" href="node_8h.html#a5dd051965b69cc2c154fa5ef5c519e12">dht_node_cancel</a>. This function is a wrapper for the low-level <a class="el" href="node_8h.html#af8ed86e3a0efdb4214c1804bf411fe25">dht_node_announce</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>The DHT node. </td></tr>
    <tr><td class="paramname">info_hash</td><td>The target infohash of the announce. </td></tr>
    <tr><td class="paramname">port</td><td>Peer port number to announce, or -1 to use the nodes's current UDP port number. </td></tr>
    <tr><td class="paramname">callback</td><td>Function that will be called when the announce is complete. </td></tr>
    <tr><td class="paramname">opaque</td><td>Opaque pointer that will be passed to the callback when the announce is complete. </td></tr>
    <tr><td class="paramname">handle</td><td>Pointer to a variable that will receive the search handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the announce sucessfully started, or -1 in case of failure. </dd></dl>

</div>
</div>
<a class="anchor" id="a2554096dd998f0f2465dcbd9e59c202a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dht_get_peers </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdht__node.html">dht_node</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char&#160;</td>
          <td class="paramname"><em>info_hash</em>[20], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="peers_8h.html#a54b3df17f6aa492ab46dc1ee8e19856b">get_peers_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>opaque</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="node_8h.html#a75404d24c510013ce7d61dee6d25323b">dht_search_t</a> *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Search the DHT for peers for an infohash. </p>
<p>Start a recursive search for peers for the given infohash on the DHT. The returned handle can be used to cancel the pending search with <a class="el" href="node_8h.html#a5dd051965b69cc2c154fa5ef5c519e12">dht_node_cancel</a>. This function is a wrapper for the low-level <a class="el" href="node_8h.html#a929022d8cc9b1f6d1f4358c66daafa50">dht_node_search</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>The DHT node. </td></tr>
    <tr><td class="paramname">info_hash</td><td>The target infohash of the search. </td></tr>
    <tr><td class="paramname">callback</td><td>Function that will be called when the search completes. </td></tr>
    <tr><td class="paramname">opaque</td><td>Opaque pointer that will be passed to the callback when the search completes. </td></tr>
    <tr><td class="paramname">handle</td><td>Pointer to a variable that will receive the search handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the search sucessfully started, or -1 in case of failure. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
